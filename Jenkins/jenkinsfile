pipeline {
    agent any
    stages {
    stage('Cloning Git') {
      steps {
        git([url: 'https://github.com/hosnikadour1/kubeadm.git', branch: 'main', credentialsId: 'github'])
 
      }
    }
   stage('deploy in kubeadm') {

   steps {
      sshagent(['k8s']) {
      sh "scp -o strictHostkeyChecking=no client-depl.yml ubuntu@54.82.11.205:/home/ubuntu"
       sh "scp -o strictHostkeyChecking=no server-depl.yml ubuntu@54.82.11.205:/home/ubuntu"
        sh "scp -o strictHostkeyChecking=no mongo-depl.yml ubuntu@54.82.11.205:/home/ubuntu"
        sh "scp -o strictHostkeyChecking=no mongo-pvc.yml ubuntu@54.82.11.205:/home/ubuntu"
        sh "scp -o strictHostkeyChecking=no mongo-secret.yml ubuntu@54.82.11.205:/home/ubuntu"
        sh "scp -o strictHostkeyChecking=no ingress-srv.yml ubuntu@54.82.11.205:/home/ubuntu"


      script{
        try{
          sh "ssh ubuntu@54.82.11.205 kubectl apply  -f . "
        }catch(error){
           sh "ssh ubuntu@54.82.11.205 kubectl create  -f ."
        }                                                    
      }
}

     }


    }
    }
}
   

    